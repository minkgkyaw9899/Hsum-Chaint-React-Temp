name: TEST

on:
  pull_request_target:
    branches: [develop]

jobs:
  tests:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      - uses: oven-sh/setup-bun@v1

      - name: Install dependencies
        run: bun install

      - name: Run tests
        run: bun run test:ci

  notify-test-failure:
    needs: tests
    if: failure()
    uses: ./.github/workflows/reusable-telegram.yml
    secrets: inherit
    with:
      message: |
        <b>ðŸ”” *Tests Failed*</b>

        <b>Project:</b> NextJS
        <b>Actor:</b> ${{ github.actor }}
        <b>Title:</b> ${{ github.event.pull_request.title }}
        <b>Branch:</b> `${{ github.head_ref }}` â†’ `${{ github.base_ref }}`

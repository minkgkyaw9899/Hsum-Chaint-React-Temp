name: TEST

on:
  pull_request_target:
    branches: [develop]

jobs:
  tests:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      - uses: oven-sh/setup-bun@v1

      - name: Install dependencies
        run: bun install

      - name: Run tests
        run: bun run test:ci

  notify-test-failure:
    needs: tests
    if: failure()
    uses: ./.github/workflows/reusable-telegram.yml
    secrets: inherit
    with:
      message: |
        âŒ *Pipeline Failed â€” Tests*
        ğŸ“¦ `${{ github.repository }}`
        ğŸ‘¤ ${{ github.actor }}
        ğŸ“Œ ${{ github.event.pull_request.title }}
        ğŸŒ¿ `${{ github.head_ref }}` â†’ `${{ github.base_ref }}`
        ğŸ”— ${{ github.event.pull_request.html_url }}
